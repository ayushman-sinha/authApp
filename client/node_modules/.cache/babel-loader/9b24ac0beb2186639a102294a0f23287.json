{"ast":null,"code":"import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\n\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader) {\n  checkKeyType(alg, key, 'decrypt');\n\n  switch (alg) {\n    case 'dir':\n      {\n        if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        return key;\n      }\n\n    case 'ECDH-ES':\n      if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n\n    case 'ECDH-ES+A128KW':\n    case 'ECDH-ES+A192KW':\n    case 'ECDH-ES+A256KW':\n      {\n        if (!isObject(joseHeader.epk)) throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n        if (!ECDH.ecdhAllowed(key)) throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n        const epk = await importJWK(joseHeader.epk, alg);\n        let partyUInfo;\n        let partyVInfo;\n\n        if (joseHeader.apu !== undefined) {\n          if (typeof joseHeader.apu !== 'string') throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n          partyUInfo = base64url(joseHeader.apu);\n        }\n\n        if (joseHeader.apv !== undefined) {\n          if (typeof joseHeader.apv !== 'string') throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n          partyVInfo = base64url(joseHeader.apv);\n        }\n\n        const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n        if (alg === 'ECDH-ES') return sharedSecret;\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n      }\n\n    case 'RSA1_5':\n    case 'RSA-OAEP':\n    case 'RSA-OAEP-256':\n    case 'RSA-OAEP-384':\n    case 'RSA-OAEP-512':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return rsaEs(alg, key, encryptedKey);\n      }\n\n    case 'PBES2-HS256+A128KW':\n    case 'PBES2-HS384+A192KW':\n    case 'PBES2-HS512+A256KW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        if (typeof joseHeader.p2c !== 'number') throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n        if (typeof joseHeader.p2s !== 'string') throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n        return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, base64url(joseHeader.p2s));\n      }\n\n    case 'A128KW':\n    case 'A192KW':\n    case 'A256KW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return aesKw(alg, key, encryptedKey);\n      }\n\n    case 'A128GCMKW':\n    case 'A192GCMKW':\n    case 'A256GCMKW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        if (typeof joseHeader.iv !== 'string') throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n        if (typeof joseHeader.tag !== 'string') throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n        const iv = base64url(joseHeader.iv);\n        const tag = base64url(joseHeader.tag);\n        return aesGcmKw(alg, key, encryptedKey, iv, tag);\n      }\n\n    default:\n      {\n        throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n      }\n  }\n}\n\nexport default decryptKeyManagement;","map":{"version":3,"names":["unwrap","aesKw","ECDH","decrypt","pbes2Kw","rsaEs","decode","base64url","JOSENotSupported","JWEInvalid","bitLength","cekLength","importJWK","checkKeyType","isObject","aesGcmKw","decryptKeyManagement","alg","key","encryptedKey","joseHeader","undefined","epk","ecdhAllowed","partyUInfo","partyVInfo","apu","apv","sharedSecret","deriveKey","enc","parseInt","slice","p2c","p2s","iv","tag"],"sources":["D:/React/authApp/client/node_modules/jose/dist/browser/lib/decrypt_key_management.js"],"sourcesContent":["import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader) {\n    checkKeyType(alg, key, 'decrypt');\n    switch (alg) {\n        case 'dir': {\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n            return key;\n        }\n        case 'ECDH-ES':\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!isObject(joseHeader.epk))\n                throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n            if (!ECDH.ecdhAllowed(key))\n                throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            const epk = await importJWK(joseHeader.epk, alg);\n            let partyUInfo;\n            let partyVInfo;\n            if (joseHeader.apu !== undefined) {\n                if (typeof joseHeader.apu !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n                partyUInfo = base64url(joseHeader.apu);\n            }\n            if (joseHeader.apv !== undefined) {\n                if (typeof joseHeader.apv !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n                partyVInfo = base64url(joseHeader.apv);\n            }\n            const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n            if (alg === 'ECDH-ES')\n                return sharedSecret;\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return rsaEs(alg, key, encryptedKey);\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.p2c !== 'number')\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n            if (typeof joseHeader.p2s !== 'string')\n                throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n            return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, base64url(joseHeader.p2s));\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg, key, encryptedKey);\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.iv !== 'string')\n                throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n            if (typeof joseHeader.tag !== 'string')\n                throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n            const iv = base64url(joseHeader.iv);\n            const tag = base64url(joseHeader.tag);\n            return aesGcmKw(alg, key, encryptedKey, iv, tag);\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n}\nexport default decryptKeyManagement;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}