{"ast":null,"code":"import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\n\nfunction getKtyFromAlg(alg) {\n  switch (typeof alg === 'string' && alg.slice(0, 2)) {\n    case 'RS':\n    case 'PS':\n      return 'RSA';\n\n    case 'ES':\n      return 'EC';\n\n    case 'Ed':\n      return 'OKP';\n\n    default:\n      throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n  }\n}\n\nexport function isJWKSLike(jwks) {\n  return jwks && typeof jwks === 'object' && Array.isArray(jwks.keys) && jwks.keys.every(isJWKLike);\n}\n\nfunction isJWKLike(key) {\n  return isObject(key);\n}\n\nfunction clone(obj) {\n  if (typeof structuredClone === 'function') {\n    return structuredClone(obj);\n  }\n\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport class LocalJWKSet {\n  constructor(jwks) {\n    this._cached = new WeakMap();\n\n    if (!isJWKSLike(jwks)) {\n      throw new JWKSInvalid('JSON Web Key Set malformed');\n    }\n\n    this._jwks = clone(jwks);\n  }\n\n  async getKey(protectedHeader, token) {\n    const {\n      alg,\n      kid\n    } = { ...protectedHeader,\n      ...token.header\n    };\n    const kty = getKtyFromAlg(alg);\n\n    const candidates = this._jwks.keys.filter(jwk => {\n      let candidate = kty === jwk.kty;\n\n      if (candidate && typeof kid === 'string') {\n        candidate = kid === jwk.kid;\n      }\n\n      if (candidate && typeof jwk.alg === 'string') {\n        candidate = alg === jwk.alg;\n      }\n\n      if (candidate && typeof jwk.use === 'string') {\n        candidate = jwk.use === 'sig';\n      }\n\n      if (candidate && Array.isArray(jwk.key_ops)) {\n        candidate = jwk.key_ops.includes('verify');\n      }\n\n      if (candidate && alg === 'EdDSA') {\n        candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n      }\n\n      if (candidate) {\n        switch (alg) {\n          case 'ES256':\n            candidate = jwk.crv === 'P-256';\n            break;\n\n          case 'ES256K':\n            candidate = jwk.crv === 'secp256k1';\n            break;\n\n          case 'ES384':\n            candidate = jwk.crv === 'P-384';\n            break;\n\n          case 'ES512':\n            candidate = jwk.crv === 'P-521';\n            break;\n        }\n      }\n\n      return candidate;\n    });\n\n    const {\n      0: jwk,\n      length\n    } = candidates;\n\n    if (length === 0) {\n      throw new JWKSNoMatchingKey();\n    } else if (length !== 1) {\n      throw new JWKSMultipleMatchingKeys();\n    }\n\n    const cached = this._cached.get(jwk) || this._cached.set(jwk, {}).get(jwk);\n\n    if (cached[alg] === undefined) {\n      const keyObject = await importJWK({ ...jwk,\n        ext: true\n      }, alg);\n\n      if (keyObject instanceof Uint8Array || keyObject.type !== 'public') {\n        throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n      }\n\n      cached[alg] = keyObject;\n    }\n\n    return cached[alg];\n  }\n\n}\nexport function createLocalJWKSet(jwks) {\n  return LocalJWKSet.prototype.getKey.bind(new LocalJWKSet(jwks));\n}","map":{"version":3,"names":["importJWK","JWKSInvalid","JOSENotSupported","JWKSNoMatchingKey","JWKSMultipleMatchingKeys","isObject","getKtyFromAlg","alg","slice","isJWKSLike","jwks","Array","isArray","keys","every","isJWKLike","key","clone","obj","structuredClone","JSON","parse","stringify","LocalJWKSet","constructor","_cached","WeakMap","_jwks","getKey","protectedHeader","token","kid","header","kty","candidates","filter","jwk","candidate","use","key_ops","includes","crv","length","cached","get","set","undefined","keyObject","ext","Uint8Array","type","createLocalJWKSet","prototype","bind"],"sources":["D:/React/authApp/client/node_modules/jose/dist/browser/jwks/local.js"],"sourcesContent":["import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nexport function isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nexport class LocalJWKSet {\n    constructor(jwks) {\n        this._cached = new WeakMap();\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate && alg === 'EdDSA') {\n                candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        else if (length !== 1) {\n            throw new JWKSMultipleMatchingKeys();\n        }\n        const cached = this._cached.get(jwk) || this._cached.set(jwk, {}).get(jwk);\n        if (cached[alg] === undefined) {\n            const keyObject = await importJWK({ ...jwk, ext: true }, alg);\n            if (keyObject instanceof Uint8Array || keyObject.type !== 'public') {\n                throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n            }\n            cached[alg] = keyObject;\n        }\n        return cached[alg];\n    }\n}\nexport function createLocalJWKSet(jwks) {\n    return LocalJWKSet.prototype.getKey.bind(new LocalJWKSet(jwks));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}