{"ast":null,"code":"import { FlattenedSign } from '../flattened/sign.js';\nimport { JWSInvalid } from '../../util/errors.js';\n\nclass IndividualSignature {\n  constructor(sig, key, options) {\n    this.parent = sig;\n    this.key = key;\n    this.options = options;\n  }\n\n  setProtectedHeader(protectedHeader) {\n    if (this.protectedHeader) {\n      throw new TypeError('setProtectedHeader can only be called once');\n    }\n\n    this.protectedHeader = protectedHeader;\n    return this;\n  }\n\n  setUnprotectedHeader(unprotectedHeader) {\n    if (this.unprotectedHeader) {\n      throw new TypeError('setUnprotectedHeader can only be called once');\n    }\n\n    this.unprotectedHeader = unprotectedHeader;\n    return this;\n  }\n\n  addSignature() {\n    return this.parent.addSignature(...arguments);\n  }\n\n  sign() {\n    return this.parent.sign(...arguments);\n  }\n\n  done() {\n    return this.parent;\n  }\n\n}\n\nexport class GeneralSign {\n  constructor(payload) {\n    this._signatures = [];\n    this._payload = payload;\n  }\n\n  addSignature(key, options) {\n    const signature = new IndividualSignature(this, key, options);\n\n    this._signatures.push(signature);\n\n    return signature;\n  }\n\n  async sign() {\n    if (!this._signatures.length) {\n      throw new JWSInvalid('at least one signature must be added');\n    }\n\n    const jws = {\n      signatures: [],\n      payload: ''\n    };\n\n    for (let i = 0; i < this._signatures.length; i++) {\n      const signature = this._signatures[i];\n      const flattened = new FlattenedSign(this._payload);\n      flattened.setProtectedHeader(signature.protectedHeader);\n      flattened.setUnprotectedHeader(signature.unprotectedHeader);\n      const {\n        payload,\n        ...rest\n      } = await flattened.sign(signature.key, signature.options);\n\n      if (i === 0) {\n        jws.payload = payload;\n      } else if (jws.payload !== payload) {\n        throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\n      }\n\n      jws.signatures.push(rest);\n    }\n\n    return jws;\n  }\n\n}","map":{"version":3,"names":["FlattenedSign","JWSInvalid","IndividualSignature","constructor","sig","key","options","parent","setProtectedHeader","protectedHeader","TypeError","setUnprotectedHeader","unprotectedHeader","addSignature","sign","done","GeneralSign","payload","_signatures","_payload","signature","push","length","jws","signatures","i","flattened","rest"],"sources":["D:/React/authApp/client/node_modules/jose/dist/browser/jws/general/sign.js"],"sourcesContent":["import { FlattenedSign } from '../flattened/sign.js';\nimport { JWSInvalid } from '../../util/errors.js';\nclass IndividualSignature {\n    constructor(sig, key, options) {\n        this.parent = sig;\n        this.key = key;\n        this.options = options;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this.protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this.protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this.unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this.unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    addSignature(...args) {\n        return this.parent.addSignature(...args);\n    }\n    sign(...args) {\n        return this.parent.sign(...args);\n    }\n    done() {\n        return this.parent;\n    }\n}\nexport class GeneralSign {\n    constructor(payload) {\n        this._signatures = [];\n        this._payload = payload;\n    }\n    addSignature(key, options) {\n        const signature = new IndividualSignature(this, key, options);\n        this._signatures.push(signature);\n        return signature;\n    }\n    async sign() {\n        if (!this._signatures.length) {\n            throw new JWSInvalid('at least one signature must be added');\n        }\n        const jws = {\n            signatures: [],\n            payload: '',\n        };\n        for (let i = 0; i < this._signatures.length; i++) {\n            const signature = this._signatures[i];\n            const flattened = new FlattenedSign(this._payload);\n            flattened.setProtectedHeader(signature.protectedHeader);\n            flattened.setUnprotectedHeader(signature.unprotectedHeader);\n            const { payload, ...rest } = await flattened.sign(signature.key, signature.options);\n            if (i === 0) {\n                jws.payload = payload;\n            }\n            else if (jws.payload !== payload) {\n                throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\n            }\n            jws.signatures.push(rest);\n        }\n        return jws;\n    }\n}\n"],"mappings":"AAAA,SAASA,aAAT,QAA8B,sBAA9B;AACA,SAASC,UAAT,QAA2B,sBAA3B;;AACA,MAAMC,mBAAN,CAA0B;EACtBC,WAAW,CAACC,GAAD,EAAMC,GAAN,EAAWC,OAAX,EAAoB;IAC3B,KAAKC,MAAL,GAAcH,GAAd;IACA,KAAKC,GAAL,GAAWA,GAAX;IACA,KAAKC,OAAL,GAAeA,OAAf;EACH;;EACDE,kBAAkB,CAACC,eAAD,EAAkB;IAChC,IAAI,KAAKA,eAAT,EAA0B;MACtB,MAAM,IAAIC,SAAJ,CAAc,4CAAd,CAAN;IACH;;IACD,KAAKD,eAAL,GAAuBA,eAAvB;IACA,OAAO,IAAP;EACH;;EACDE,oBAAoB,CAACC,iBAAD,EAAoB;IACpC,IAAI,KAAKA,iBAAT,EAA4B;MACxB,MAAM,IAAIF,SAAJ,CAAc,8CAAd,CAAN;IACH;;IACD,KAAKE,iBAAL,GAAyBA,iBAAzB;IACA,OAAO,IAAP;EACH;;EACDC,YAAY,GAAU;IAClB,OAAO,KAAKN,MAAL,CAAYM,YAAZ,CAAyB,YAAzB,CAAP;EACH;;EACDC,IAAI,GAAU;IACV,OAAO,KAAKP,MAAL,CAAYO,IAAZ,CAAiB,YAAjB,CAAP;EACH;;EACDC,IAAI,GAAG;IACH,OAAO,KAAKR,MAAZ;EACH;;AA5BqB;;AA8B1B,OAAO,MAAMS,WAAN,CAAkB;EACrBb,WAAW,CAACc,OAAD,EAAU;IACjB,KAAKC,WAAL,GAAmB,EAAnB;IACA,KAAKC,QAAL,GAAgBF,OAAhB;EACH;;EACDJ,YAAY,CAACR,GAAD,EAAMC,OAAN,EAAe;IACvB,MAAMc,SAAS,GAAG,IAAIlB,mBAAJ,CAAwB,IAAxB,EAA8BG,GAA9B,EAAmCC,OAAnC,CAAlB;;IACA,KAAKY,WAAL,CAAiBG,IAAjB,CAAsBD,SAAtB;;IACA,OAAOA,SAAP;EACH;;EACS,MAAJN,IAAI,GAAG;IACT,IAAI,CAAC,KAAKI,WAAL,CAAiBI,MAAtB,EAA8B;MAC1B,MAAM,IAAIrB,UAAJ,CAAe,sCAAf,CAAN;IACH;;IACD,MAAMsB,GAAG,GAAG;MACRC,UAAU,EAAE,EADJ;MAERP,OAAO,EAAE;IAFD,CAAZ;;IAIA,KAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKP,WAAL,CAAiBI,MAArC,EAA6CG,CAAC,EAA9C,EAAkD;MAC9C,MAAML,SAAS,GAAG,KAAKF,WAAL,CAAiBO,CAAjB,CAAlB;MACA,MAAMC,SAAS,GAAG,IAAI1B,aAAJ,CAAkB,KAAKmB,QAAvB,CAAlB;MACAO,SAAS,CAAClB,kBAAV,CAA6BY,SAAS,CAACX,eAAvC;MACAiB,SAAS,CAACf,oBAAV,CAA+BS,SAAS,CAACR,iBAAzC;MACA,MAAM;QAAEK,OAAF;QAAW,GAAGU;MAAd,IAAuB,MAAMD,SAAS,CAACZ,IAAV,CAAeM,SAAS,CAACf,GAAzB,EAA8Be,SAAS,CAACd,OAAxC,CAAnC;;MACA,IAAImB,CAAC,KAAK,CAAV,EAAa;QACTF,GAAG,CAACN,OAAJ,GAAcA,OAAd;MACH,CAFD,MAGK,IAAIM,GAAG,CAACN,OAAJ,KAAgBA,OAApB,EAA6B;QAC9B,MAAM,IAAIhB,UAAJ,CAAe,4DAAf,CAAN;MACH;;MACDsB,GAAG,CAACC,UAAJ,CAAeH,IAAf,CAAoBM,IAApB;IACH;;IACD,OAAOJ,GAAP;EACH;;AAjCoB"},"metadata":{},"sourceType":"module"}