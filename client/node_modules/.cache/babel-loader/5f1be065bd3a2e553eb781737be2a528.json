{"ast":null,"code":"import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport checkKeyType from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nexport async function flattenedVerify(jws, key, options) {\n  var _a;\n\n  if (!isObject(jws)) {\n    throw new JWSInvalid('Flattened JWS must be an object');\n  }\n\n  if (jws.protected === undefined && jws.header === undefined) {\n    throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n  }\n\n  if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n    throw new JWSInvalid('JWS Protected Header incorrect type');\n  }\n\n  if (jws.payload === undefined) {\n    throw new JWSInvalid('JWS Payload missing');\n  }\n\n  if (typeof jws.signature !== 'string') {\n    throw new JWSInvalid('JWS Signature missing or incorrect type');\n  }\n\n  if (jws.header !== undefined && !isObject(jws.header)) {\n    throw new JWSInvalid('JWS Unprotected Header incorrect type');\n  }\n\n  let parsedProt = {};\n\n  if (jws.protected) {\n    const protectedHeader = base64url(jws.protected);\n\n    try {\n      parsedProt = JSON.parse(decoder.decode(protectedHeader));\n    } catch (_b) {\n      throw new JWSInvalid('JWS Protected Header is invalid');\n    }\n  }\n\n  if (!isDisjoint(parsedProt, jws.header)) {\n    throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n  }\n\n  const joseHeader = { ...parsedProt,\n    ...jws.header\n  };\n  const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options === null || options === void 0 ? void 0 : options.crit, parsedProt, joseHeader);\n  let b64 = true;\n\n  if (extensions.has('b64')) {\n    b64 = parsedProt.b64;\n\n    if (typeof b64 !== 'boolean') {\n      throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n    }\n  }\n\n  const {\n    alg\n  } = joseHeader;\n\n  if (typeof alg !== 'string' || !alg) {\n    throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n  }\n\n  const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n\n  if (algorithms && !algorithms.has(alg)) {\n    throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter not allowed');\n  }\n\n  if (b64) {\n    if (typeof jws.payload !== 'string') {\n      throw new JWSInvalid('JWS Payload must be a string');\n    }\n  } else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n    throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n  }\n\n  let resolvedKey = false;\n\n  if (typeof key === 'function') {\n    key = await key(parsedProt, jws);\n    resolvedKey = true;\n  }\n\n  checkKeyType(alg, key, 'verify');\n  const data = concat(encoder.encode((_a = jws.protected) !== null && _a !== void 0 ? _a : ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n  const signature = base64url(jws.signature);\n  const verified = await verify(alg, key, signature, data);\n\n  if (!verified) {\n    throw new JWSSignatureVerificationFailed();\n  }\n\n  let payload;\n\n  if (b64) {\n    payload = base64url(jws.payload);\n  } else if (typeof jws.payload === 'string') {\n    payload = encoder.encode(jws.payload);\n  } else {\n    payload = jws.payload;\n  }\n\n  const result = {\n    payload\n  };\n\n  if (jws.protected !== undefined) {\n    result.protectedHeader = parsedProt;\n  }\n\n  if (jws.header !== undefined) {\n    result.unprotectedHeader = jws.header;\n  }\n\n  if (resolvedKey) {\n    return { ...result,\n      key\n    };\n  }\n\n  return result;\n}","map":{"version":3,"names":["decode","base64url","verify","JOSEAlgNotAllowed","JWSInvalid","JWSSignatureVerificationFailed","concat","encoder","decoder","isDisjoint","isObject","checkKeyType","validateCrit","validateAlgorithms","flattenedVerify","jws","key","options","_a","protected","undefined","header","payload","signature","parsedProt","protectedHeader","JSON","parse","_b","joseHeader","extensions","Map","crit","b64","has","alg","algorithms","Uint8Array","resolvedKey","data","encode","verified","result","unprotectedHeader"],"sources":["D:/React/authApp/client/node_modules/jose/dist/browser/jws/flattened/verify.js"],"sourcesContent":["import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport checkKeyType from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nexport async function flattenedVerify(jws, key, options) {\n    var _a;\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        const protectedHeader = base64url(jws.protected);\n        try {\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch (_b) {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options === null || options === void 0 ? void 0 : options.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n    }\n    checkKeyType(alg, key, 'verify');\n    const data = concat(encoder.encode((_a = jws.protected) !== null && _a !== void 0 ? _a : ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n    const signature = base64url(jws.signature);\n    const verified = await verify(alg, key, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        payload = base64url(jws.payload);\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}