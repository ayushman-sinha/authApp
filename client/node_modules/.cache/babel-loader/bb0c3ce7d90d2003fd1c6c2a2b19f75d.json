{"ast":null,"code":"import fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\n\nclass RemoteJWKSet extends LocalJWKSet {\n  constructor(url, options) {\n    super({\n      keys: []\n    });\n    this._jwks = undefined;\n\n    if (!(url instanceof URL)) {\n      throw new TypeError('url must be an instance of URL');\n    }\n\n    this._url = new URL(url.href);\n    this._options = {\n      agent: options === null || options === void 0 ? void 0 : options.agent,\n      headers: options === null || options === void 0 ? void 0 : options.headers\n    };\n    this._timeoutDuration = typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n    this._cooldownDuration = typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n    this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n  }\n\n  coolingDown() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cooldownDuration : false;\n  }\n\n  fresh() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cacheMaxAge : false;\n  }\n\n  async getKey(protectedHeader, token) {\n    if (!this._jwks || !this.fresh()) {\n      await this.reload();\n    }\n\n    try {\n      return await super.getKey(protectedHeader, token);\n    } catch (err) {\n      if (err instanceof JWKSNoMatchingKey) {\n        if (this.coolingDown() === false) {\n          await this.reload();\n          return super.getKey(protectedHeader, token);\n        }\n      }\n\n      throw err;\n    }\n  }\n\n  async reload() {\n    if (this._pendingFetch && isCloudflareWorkers()) {\n      return new Promise(resolve => {\n        const isDone = () => {\n          if (this._pendingFetch === undefined) {\n            resolve();\n          } else {\n            setTimeout(isDone, 5);\n          }\n        };\n\n        isDone();\n      });\n    }\n\n    if (!this._pendingFetch) {\n      this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options).then(json => {\n        if (!isJWKSLike(json)) {\n          throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n\n        this._jwks = {\n          keys: json.keys\n        };\n        this._jwksTimestamp = Date.now();\n        this._pendingFetch = undefined;\n      }).catch(err => {\n        this._pendingFetch = undefined;\n        throw err;\n      });\n    }\n\n    await this._pendingFetch;\n  }\n\n}\n\nexport function createRemoteJWKSet(url, options) {\n  return RemoteJWKSet.prototype.getKey.bind(new RemoteJWKSet(url, options));\n}","map":{"version":3,"names":["fetchJwks","isCloudflareWorkers","JWKSInvalid","JWKSNoMatchingKey","isJWKSLike","LocalJWKSet","RemoteJWKSet","constructor","url","options","keys","_jwks","undefined","URL","TypeError","_url","href","_options","agent","headers","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","cacheMaxAge","coolingDown","_jwksTimestamp","Date","now","fresh","getKey","protectedHeader","token","reload","err","_pendingFetch","Promise","resolve","isDone","setTimeout","then","json","catch","createRemoteJWKSet","prototype","bind"],"sources":["D:/React/authApp/client/node_modules/jose/dist/browser/jwks/remote.js"],"sourcesContent":["import fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nclass RemoteJWKSet extends LocalJWKSet {\n    constructor(url, options) {\n        super({ keys: [] });\n        this._jwks = undefined;\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options === null || options === void 0 ? void 0 : options.agent, headers: options === null || options === void 0 ? void 0 : options.headers };\n        this._timeoutDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._jwks || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await super.getKey(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return super.getKey(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            return new Promise((resolve) => {\n                const isDone = () => {\n                    if (this._pendingFetch === undefined) {\n                        resolve();\n                    }\n                    else {\n                        setTimeout(isDone, 5);\n                    }\n                };\n                isDone();\n            });\n        }\n        if (!this._pendingFetch) {\n            this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n                .then((json) => {\n                if (!isJWKSLike(json)) {\n                    throw new JWKSInvalid('JSON Web Key Set malformed');\n                }\n                this._jwks = { keys: json.keys };\n                this._jwksTimestamp = Date.now();\n                this._pendingFetch = undefined;\n            })\n                .catch((err) => {\n                this._pendingFetch = undefined;\n                throw err;\n            });\n        }\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    return RemoteJWKSet.prototype.getKey.bind(new RemoteJWKSet(url, options));\n}\n"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,0BAAtB;AACA,SAASC,mBAAT,QAAoC,mBAApC;AACA,SAASC,WAAT,EAAsBC,iBAAtB,QAA+C,mBAA/C;AACA,SAASC,UAAT,EAAqBC,WAArB,QAAwC,YAAxC;;AACA,MAAMC,YAAN,SAA2BD,WAA3B,CAAuC;EACnCE,WAAW,CAACC,GAAD,EAAMC,OAAN,EAAe;IACtB,MAAM;MAAEC,IAAI,EAAE;IAAR,CAAN;IACA,KAAKC,KAAL,GAAaC,SAAb;;IACA,IAAI,EAAEJ,GAAG,YAAYK,GAAjB,CAAJ,EAA2B;MACvB,MAAM,IAAIC,SAAJ,CAAc,gCAAd,CAAN;IACH;;IACD,KAAKC,IAAL,GAAY,IAAIF,GAAJ,CAAQL,GAAG,CAACQ,IAAZ,CAAZ;IACA,KAAKC,QAAL,GAAgB;MAAEC,KAAK,EAAET,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACS,KAAnE;MAA0EC,OAAO,EAAEV,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACU;IAA7I,CAAhB;IACA,KAAKC,gBAAL,GACI,QAAQX,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACY,eAAlE,MAAuF,QAAvF,GAAkGZ,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACY,eAA5J,GAA8K,IADlL;IAEA,KAAKC,iBAAL,GACI,QAAQb,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACc,gBAAlE,MAAwF,QAAxF,GAAmGd,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACc,gBAA7J,GAAgL,KADpL;IAEA,KAAKC,YAAL,GAAoB,QAAQf,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACgB,WAAlE,MAAmF,QAAnF,GAA8FhB,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACgB,WAAxJ,GAAsK,MAA1L;EACH;;EACDC,WAAW,GAAG;IACV,OAAO,OAAO,KAAKC,cAAZ,KAA+B,QAA/B,GACDC,IAAI,CAACC,GAAL,KAAa,KAAKF,cAAL,GAAsB,KAAKL,iBADvC,GAED,KAFN;EAGH;;EACDQ,KAAK,GAAG;IACJ,OAAO,OAAO,KAAKH,cAAZ,KAA+B,QAA/B,GACDC,IAAI,CAACC,GAAL,KAAa,KAAKF,cAAL,GAAsB,KAAKH,YADvC,GAED,KAFN;EAGH;;EACW,MAANO,MAAM,CAACC,eAAD,EAAkBC,KAAlB,EAAyB;IACjC,IAAI,CAAC,KAAKtB,KAAN,IAAe,CAAC,KAAKmB,KAAL,EAApB,EAAkC;MAC9B,MAAM,KAAKI,MAAL,EAAN;IACH;;IACD,IAAI;MACA,OAAO,MAAM,MAAMH,MAAN,CAAaC,eAAb,EAA8BC,KAA9B,CAAb;IACH,CAFD,CAGA,OAAOE,GAAP,EAAY;MACR,IAAIA,GAAG,YAAYhC,iBAAnB,EAAsC;QAClC,IAAI,KAAKuB,WAAL,OAAuB,KAA3B,EAAkC;UAC9B,MAAM,KAAKQ,MAAL,EAAN;UACA,OAAO,MAAMH,MAAN,CAAaC,eAAb,EAA8BC,KAA9B,CAAP;QACH;MACJ;;MACD,MAAME,GAAN;IACH;EACJ;;EACW,MAAND,MAAM,GAAG;IACX,IAAI,KAAKE,aAAL,IAAsBnC,mBAAmB,EAA7C,EAAiD;MAC7C,OAAO,IAAIoC,OAAJ,CAAaC,OAAD,IAAa;QAC5B,MAAMC,MAAM,GAAG,MAAM;UACjB,IAAI,KAAKH,aAAL,KAAuBxB,SAA3B,EAAsC;YAClC0B,OAAO;UACV,CAFD,MAGK;YACDE,UAAU,CAACD,MAAD,EAAS,CAAT,CAAV;UACH;QACJ,CAPD;;QAQAA,MAAM;MACT,CAVM,CAAP;IAWH;;IACD,IAAI,CAAC,KAAKH,aAAV,EAAyB;MACrB,KAAKA,aAAL,GAAqBpC,SAAS,CAAC,KAAKe,IAAN,EAAY,KAAKK,gBAAjB,EAAmC,KAAKH,QAAxC,CAAT,CAChBwB,IADgB,CACVC,IAAD,IAAU;QAChB,IAAI,CAACtC,UAAU,CAACsC,IAAD,CAAf,EAAuB;UACnB,MAAM,IAAIxC,WAAJ,CAAgB,4BAAhB,CAAN;QACH;;QACD,KAAKS,KAAL,GAAa;UAAED,IAAI,EAAEgC,IAAI,CAAChC;QAAb,CAAb;QACA,KAAKiB,cAAL,GAAsBC,IAAI,CAACC,GAAL,EAAtB;QACA,KAAKO,aAAL,GAAqBxB,SAArB;MACH,CARoB,EAShB+B,KATgB,CASTR,GAAD,IAAS;QAChB,KAAKC,aAAL,GAAqBxB,SAArB;QACA,MAAMuB,GAAN;MACH,CAZoB,CAArB;IAaH;;IACD,MAAM,KAAKC,aAAX;EACH;;AAxEkC;;AA0EvC,OAAO,SAASQ,kBAAT,CAA4BpC,GAA5B,EAAiCC,OAAjC,EAA0C;EAC7C,OAAOH,YAAY,CAACuC,SAAb,CAAuBd,MAAvB,CAA8Be,IAA9B,CAAmC,IAAIxC,YAAJ,CAAiBE,GAAjB,EAAsBC,OAAtB,CAAnC,CAAP;AACH"},"metadata":{},"sourceType":"module"}